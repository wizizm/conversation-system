# Enhanced Redis ãƒ‡ãƒ¼ã‚¿æ§‹é€ ãƒ»é‹ç”¨ã‚¬ã‚¤ãƒ‰

---

## ğŸ“‹ ç›®æ¬¡

1. [æ¦‚è¦ã¨æ–°æ©Ÿèƒ½](#æ¦‚è¦ã¨æ–°æ©Ÿèƒ½)
2. [æ‹¡å¼µãƒ‡ãƒ¼ã‚¿æ§‹é€ ã®å…¨ä½“åƒ](#æ‹¡å¼µãƒ‡ãƒ¼ã‚¿æ§‹é€ ã®å…¨ä½“åƒ)
3. [ã‚¹ãƒãƒ¼ãƒˆåœ§ç¸®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ‡ãƒ¼ã‚¿](#ã‚¹ãƒãƒ¼ãƒˆåœ§ç¸®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ‡ãƒ¼ã‚¿)
4. [å¤šå±¤è¦ç´„ã‚·ã‚¹ãƒ†ãƒ ](#å¤šå±¤è¦ç´„ã‚·ã‚¹ãƒ†ãƒ )
5. [æŠ€è¡“ç”¨èªã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹](#æŠ€è¡“ç”¨èªã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹)
6. [é©å¿œçš„ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆå–å¾—](#é©å¿œçš„ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆå–å¾—)
7. [æ‹¡å¼µã•ã‚ŒãŸçŸ¥è¦‹ãƒ‡ãƒ¼ã‚¿](#æ‹¡å¼µã•ã‚ŒãŸçŸ¥è¦‹ãƒ‡ãƒ¼ã‚¿)
8. [åœ§ç¸®åŠ¹ç‡ã¨åˆ†æ](#åœ§ç¸®åŠ¹ç‡ã¨åˆ†æ)
9. [Enhanced Redis Insight ç¢ºèªæ–¹æ³•](#enhanced-redis-insight-ç¢ºèªæ–¹æ³•)
10. [é‹ç”¨ã‚³ãƒãƒ³ãƒ‰é›†ï¼ˆæ‹¡å¼µç‰ˆï¼‰](#é‹ç”¨ã‚³ãƒãƒ³ãƒ‰é›†æ‹¡å¼µç‰ˆ)
11. [ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–ï¼ˆæ–°æ©Ÿèƒ½ï¼‰](#ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–æ–°æ©Ÿèƒ½)
12. [ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ï¼ˆæ‹¡å¼µç‰ˆï¼‰](#ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°æ‹¡å¼µç‰ˆ)

---

## æ¦‚è¦ã¨æ–°æ©Ÿèƒ½

ã“ã®Enhanced Conversation Systemã§ã¯ã€å¾“æ¥ã®èª²é¡Œã‚’è§£æ±ºã™ã‚‹ä»¥ä¸‹ã®æ–°æ©Ÿèƒ½ã‚’å®Ÿè£…ã—ã¾ã—ãŸã€‚

### ğŸ†• æ–°æ©Ÿèƒ½ä¸€è¦§

#### 1. ã‚¹ãƒãƒ¼ãƒˆåœ§ç¸®ã‚·ã‚¹ãƒ†ãƒ 

- zlibåœ§ç¸®: å¹³å‡30-70%ã®å®¹é‡å‰Šæ¸›
- æå¤±ãªã—åœ§ç¸®: å®Œå…¨ãªæƒ…å ±ä¿æŒ
- åœ§ç¸®æ¯”ç‡è¿½è·¡: åŠ¹ç‡æ€§ã®å®šé‡çš„æ¸¬å®š

#### 2. å¤šå±¤è¦ç´„ã‚·ã‚¹ãƒ†ãƒ 

- çŸ­ç¸®è¦ç´„: 100-150æ–‡å­—ã®è¦ç‚¹æŠ½å‡º
- ä¸­ç¨‹åº¦è¦ç´„: 300-400æ–‡å­—ã®è©³ç´°ä¿æŒ
- ã‚­ãƒ¼ãƒã‚¤ãƒ³ãƒˆ: ç®‡æ¡æ›¸ãã«ã‚ˆã‚‹é‡è¦æƒ…å ±
- æŠ€è¡“ç”¨èªæŠ½å‡º: è‡ªå‹•çš„ãªå°‚é–€ç”¨èªè­˜åˆ¥

#### 3. é©å¿œçš„è©³ç´°ãƒ¬ãƒ™ãƒ«

- short: é«˜é€Ÿã‚¢ã‚¯ã‚»ã‚¹ç”¨
- medium: ãƒãƒ©ãƒ³ã‚¹é‡è¦–
- full: å®Œå…¨è©³ç´°ï¼ˆğŸš« content[:500]åˆ¶é™å»ƒæ­¢ï¼‰
- adaptive: æ–‡è„ˆã«å¿œã˜ãŸè‡ªå‹•é¸æŠ

#### 4. æ‹¡å¼µã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚·ã‚¹ãƒ†ãƒ 

- æŠ€è¡“ç”¨èªã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹: `tech:{term}`
- å½±éŸ¿åº¦ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹: `impact:{level}`
- åœ§ç¸®åŠ¹ç‡åˆ†æ: è‡ªå‹•çµ±è¨ˆç”Ÿæˆ

---

## æ‹¡å¼µãƒ‡ãƒ¼ã‚¿æ§‹é€ ã®å…¨ä½“åƒ

```text
Enhanced Redis Database (DB: 0)
â”œâ”€â”€ Messages (æ‹¡å¼µä¼šè©±ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸)
â”‚   â”œâ”€â”€ message:{message_id} (Hash) - ã€æ‹¡å¼µã€‘å…¨æ–‡ä¿å­˜ + åœ§ç¸®ãƒ‡ãƒ¼ã‚¿
â”‚   â”œâ”€â”€ message:{message_id}:summary (Hash) - ã€æ–°è¦ã€‘å¤šå±¤è¦ç´„
â”‚   â”œâ”€â”€ messages:timeline (Sorted Set)
â”‚   â”œâ”€â”€ session:{session_id}:messages (Set)
â”‚   â”œâ”€â”€ topic:{topic_name} (Set)
â”‚   â”œâ”€â”€ keyword:{keyword_name} (Set)
â”‚   â”œâ”€â”€ tech:{technical_term} (Set) - ã€æ–°è¦ã€‘æŠ€è¡“ç”¨èªã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
â”‚   â””â”€â”€ role:{user|assistant} (Set)
â”‚
â”œâ”€â”€ Insights (æ‹¡å¼µçŸ¥è¦‹ãƒ‡ãƒ¼ã‚¿)
â”‚   â”œâ”€â”€ insight:{insight_id} (Hash) - ã€æ‹¡å¼µã€‘è¦ç´„ãƒ»å½±éŸ¿åº¦è¿½åŠ 
â”‚   â”œâ”€â”€ insights:by_relevance (Sorted Set)
â”‚   â”œâ”€â”€ insights:{insight_type} (Set)
â”‚   â”œâ”€â”€ impact:{impact_level} (Set) - ã€æ–°è¦ã€‘å½±éŸ¿åº¦åˆ¥ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
â”‚   â””â”€â”€ business_area:{area_name} (Set)
â”‚
â”œâ”€â”€ Compression Analytics (åœ§ç¸®åˆ†æãƒ‡ãƒ¼ã‚¿) - ã€æ–°æ©Ÿèƒ½ã€‘
â”‚   â”œâ”€â”€ analytics:compression_total_saved (String)
â”‚   â”œâ”€â”€ analytics:compression_ratios (List)
â”‚   â””â”€â”€ analytics:content_lengths (List)
â”‚
â””â”€â”€ Enhanced Analytics (æ‹¡å¼µåˆ†æãƒ‡ãƒ¼ã‚¿)
    â”œâ”€â”€ analytics:total_messages (String)
    â”œâ”€â”€ analytics:daily:{YYYY-MM-DD} (String)
    â”œâ”€â”€ analytics:word_counts (List)
    â””â”€â”€ analytics:technical_terms_frequency (Hash)
```

---

## ã‚¹ãƒãƒ¼ãƒˆåœ§ç¸®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ‡ãƒ¼ã‚¿

### 1. æ‹¡å¼µãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒãƒƒã‚·ãƒ¥ï¼ˆHashæ§‹é€ ï¼‰

ã‚­ãƒ¼: `message:{message_id}`

| ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ | ãƒ‡ãƒ¼ã‚¿å‹ | èª¬æ˜ | æ–°æ©Ÿèƒ½ | ä¾‹ |
|-----------|---------|------|--------|-----|
| `id` | String | ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ä¸€æ„ID | - | `770fa214-3750-47fa-82ff-c3e25697299b` |
| `timestamp` | String | ISOå½¢å¼ã®ä½œæˆæ™‚åˆ» | - | `2024-01-15T10:30:45.123456` |
| `role` | String | ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®é€ä¿¡è€… | - | `user` / `assistant` |
| `content` | String | å®Œå…¨ãªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æœ¬æ–‡ | ğŸš« [:500]åˆ¶é™å»ƒæ­¢ | `Azure/Terraformã‚¤ãƒ³ãƒ•ãƒ©å®Ÿè£…ã«ã¤ã„ã¦...ï¼ˆå…¨æ–‡ä¿å­˜ï¼‰` |
| `compressed_content` | String | zlibåœ§ç¸®ç‰ˆï¼ˆBase64ï¼‰ | âœ… æ–°æ©Ÿèƒ½ | `eJzVWFFv2jAQ/itR3rsI...` |
| `summary_short` | String | 100-150æ–‡å­—è¦ç´„ | âœ… æ–°æ©Ÿèƒ½ | `Azure/Terraformã‚¤ãƒ³ãƒ•ãƒ©å®Ÿè£…ã§PostgreSQLæœ€é©åŒ–...` |
| `summary_medium` | String | 300-400æ–‡å­—è¦ç´„ | âœ… æ–°æ©Ÿèƒ½ | `Azure/Terraformã‚¤ãƒ³ãƒ•ãƒ©å®Ÿè£…ã«ã¤ã„ã¦ã€æ¥ç¶šãƒ—ãƒ¼ãƒ«...` |
| `key_points` | JSON String | é‡è¦ãƒã‚¤ãƒ³ãƒˆé…åˆ— | âœ… æ–°æ©Ÿèƒ½ | `["æ¥ç¶šãƒ—ãƒ¼ãƒ«è¨­å®šã®æœ€é©åŒ–", "ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹æˆ¦ç•¥"]` |
| `technical_terms` | JSON String | æŠ€è¡“ç”¨èªé…åˆ— | âœ… æ–°æ©Ÿèƒ½ | `["Terraform", "PostgreSQL", "Docker"]` |
| `topics` | JSON String | ãƒˆãƒ”ãƒƒã‚¯é…åˆ— | - | `["Azure", "ã‚¤ãƒ³ãƒ•ãƒ©", "æœ€é©åŒ–"]` |
| `keywords` | JSON String | ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰é…åˆ— | - | `["å®Ÿè£…", "ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹", "è¨­å®š"]` |
| `context_hash` | String | ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®MD5ãƒãƒƒã‚·ãƒ¥ | - | `a1b2c3d4e5f6...` |
| `session_id` | String | ã‚»ãƒƒã‚·ãƒ§ãƒ³è­˜åˆ¥å­ | - | `df2092f0-ee59-4170-afb5-1b20fd72e01c` |
| `content_length` | Integer | å…ƒã‚³ãƒ³ãƒ†ãƒ³ãƒ„é•· | âœ… æ–°æ©Ÿèƒ½ | `1247` |
| `compression_ratio` | Float | åœ§ç¸®æ¯”ç‡ | âœ… æ–°æ©Ÿèƒ½ | `0.68` |

### 2. å¤šå±¤è¦ç´„ãƒãƒƒã‚·ãƒ¥ï¼ˆæ–°æ©Ÿèƒ½ï¼‰

ã‚­ãƒ¼: `message:{message_id}:summary`

| ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ | ãƒ‡ãƒ¼ã‚¿å‹ | èª¬æ˜ | ä¾‹ |
|-----------|---------|------|-----|
| `short` | String | çŸ­ç¸®è¦ç´„ | `Azure/Terraformã‚¤ãƒ³ãƒ•ãƒ©å®Ÿè£…ã§PostgreSQLæœ€é©åŒ–ã‚’æ¤œè¨...` |
| `medium` | String | ä¸­ç¨‹åº¦è¦ç´„ | `Azure/Terraformã‚¤ãƒ³ãƒ•ãƒ©å®Ÿè£…ã«ã¤ã„ã¦ã€å¤§å¡šå•†ä¼šæ§˜å‘ã‘ã®...` |
| `key_points` | JSON String | ã‚­ãƒ¼ãƒã‚¤ãƒ³ãƒˆ | `["æ¥ç¶šãƒ—ãƒ¼ãƒ«è¨­å®š", "ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹æˆ¦ç•¥", "Dockerçµ±åˆ"]` |
| `technical_terms` | JSON String | æŠ€è¡“ç”¨èª | `["PostgreSQL", "Terraform", "Azure", "Docker"]` |

---

## å¤šå±¤è¦ç´„ã‚·ã‚¹ãƒ†ãƒ 

### é©å¿œçš„è©³ç´°ãƒ¬ãƒ™ãƒ«ã®å‹•ä½œ

```python
# è©³ç´°ãƒ¬ãƒ™ãƒ«åˆ¥ã‚³ãƒ³ãƒ†ãƒ³ãƒ„é¸æŠï¼ˆå„ªå…ˆåº¦1è§£æ±ºï¼‰
def get_content_by_detail_level(detail_level, message_index):
    if detail_level == "short":
        return summary_data.get('short')
    elif detail_level == "medium":
        return summary_data.get('medium')
    elif detail_level == "full":
        return msg_data.get('content')  # ğŸš« [:500]åˆ¶é™ãªã—ï¼
    elif detail_level == "adaptive":
        if message_index < 5:    # æœ€æ–°5ä»¶ã¯å®Œå…¨ç‰ˆ
            return msg_data.get('content')
        elif message_index < 20: # æ¬¡15ä»¶ã¯ä¸­ç¨‹åº¦
            return summary_data.get('medium')
        else:                    # å¤ã„ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯çŸ­ç¸®ç‰ˆ
            return summary_data.get('short')
```

### è¦ç´„å“è³ªã®ç‰¹å¾´

#### çŸ­ç¸®è¦ç´„ï¼ˆ100-150æ–‡å­—ï¼‰

- æœ€åˆã®æ„å‘³ã®ã‚ã‚‹æ–‡ã‚’æŠ½å‡º
- æŠ€è¡“ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’ä¿æŒ
- è‡ªç„¶ãªåˆ‡æ–­ç‚¹ã§çµ‚äº†

#### ä¸­ç¨‹åº¦è¦ç´„ï¼ˆ300-400æ–‡å­—ï¼‰

- è¤‡æ•°æ–‡ã®æ„å‘³ã‚’ä¿æŒ
- æŠ€è¡“è¦ç´ ã®è£œå®Œ
- æ–‡è„ˆã®é€£ç¶šæ€§ç¢ºä¿

#### ã‚­ãƒ¼ãƒã‚¤ãƒ³ãƒˆæŠ½å‡º

- ç•ªå·ä»˜ããƒªã‚¹ãƒˆã®è‡ªå‹•æ¤œå‡º
- é‡è¦ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰å«æœ‰æ–‡ã®æŠ½å‡º
- æŠ€è¡“çš„ã‚¢ã‚¯ã‚·ãƒ§ãƒ³é …ç›®ã®è­˜åˆ¥

---

## æŠ€è¡“ç”¨èªã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹

### æ–°ã—ã„ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹æ§‹é€ 

#### æŠ€è¡“ç”¨èªåˆ¥ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ï¼ˆSetï¼‰

```redis
tech:{technical_term} â†’ {message_id1, message_id2, ...}
# ä¾‹: tech:terraform â†’ {"770fa214-...", "881gb325-..."}
# ä¾‹: tech:postgresql â†’ {"992hc436-...", "aa3id547-..."}
```

#### æŠ€è¡“ç”¨èªã®è‡ªå‹•æŠ½å‡ºãƒ‘ã‚¿ãƒ¼ãƒ³

1. CamelCase: `PostgreSQL`, `FastAPI`, `JavaScript`
2. ã‚¢ã‚¯ãƒ­ãƒ‹ãƒ : `API`, `SQL`, `HTTP`, `SSL`
3. ãƒ•ã‚¡ã‚¤ãƒ«æ‹¡å¼µå­: `.py`, `.js`, `.tsx`, `.go`
4. ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ : `Docker`, `Kubernetes`, `AWS`, `Azure`
5. ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯: `React`, `Django`, `Spring`
6. æ—¥æœ¬èªæŠ€è¡“ç”¨èª: `ã‚·ã‚¹ãƒ†ãƒ `, `ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹`, `ã‚µãƒ¼ãƒãƒ¼`

---

## é©å¿œçš„ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆå–å¾—

### è©³ç´°ãƒ¬ãƒ™ãƒ«åˆ¥å‹•ä½œï¼ˆå„ªå…ˆåº¦1ãƒ»3è§£æ±ºï¼‰

```bash
# çŸ­ç¸®ãƒ¬ãƒ™ãƒ« - é«˜é€Ÿã‚¢ã‚¯ã‚»ã‚¹
GET /context?detail_level=short&limit=50
â†’ å„ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸100-150æ–‡å­—è¦ç´„

# ä¸­ç¨‹åº¦ãƒ¬ãƒ™ãƒ« - ãƒãƒ©ãƒ³ã‚¹é‡è¦–  
GET /context?detail_level=medium&limit=50
â†’ å„ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸300-400æ–‡å­—è¦ç´„

# å®Œå…¨ãƒ¬ãƒ™ãƒ« - è©³ç´°åˆ†æç”¨ï¼ˆğŸš«åˆ¶é™ãªã—ï¼‰
GET /context?detail_level=full&limit=50
â†’ å„ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®å®Œå…¨ãªã‚³ãƒ³ãƒ†ãƒ³ãƒ„

# é©å¿œãƒ¬ãƒ™ãƒ« - ã‚¤ãƒ³ãƒ†ãƒªã‚¸ã‚§ãƒ³ãƒˆé¸æŠ
GET /context?detail_level=adaptive&limit=50
â†’ æœ€æ–°5ä»¶:å®Œå…¨ç‰ˆ, æ¬¡15ä»¶:ä¸­ç¨‹åº¦, å¤ã„30ä»¶:çŸ­ç¸®ç‰ˆ
```

### é©å¿œçš„é¸æŠã®ãƒ¡ãƒªãƒƒãƒˆ

1. æœ€æ–°æƒ…å ±: ç›´è¿‘ã®ä¼šè©±ã¯å®Œå…¨è©³ç´°ã§æ–‡è„ˆä¿æŒ
2. åŠ¹ç‡æ€§: å¤ã„æƒ…å ±ã¯è¦ç´„ã§å®¹é‡ç¯€ç´„
3. é–¢é€£æ€§: é‡è¦åº¦ã«å¿œã˜ãŸè‡ªå‹•èª¿æ•´
4. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹: å¿…è¦ãªè©³ç´°åº¦ã®ã¿å–å¾—

---

## æ‹¡å¼µã•ã‚ŒãŸçŸ¥è¦‹ãƒ‡ãƒ¼ã‚¿

### æ‹¡å¼µçŸ¥è¦‹ãƒãƒƒã‚·ãƒ¥

ã‚­ãƒ¼: `insight:{insight_id}`

| ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ | ãƒ‡ãƒ¼ã‚¿å‹ | èª¬æ˜ | æ–°æ©Ÿèƒ½ | ä¾‹ |
|-----------|---------|------|--------|-----|
| `id` | String | çŸ¥è¦‹ã®ä¸€æ„ID | - | `insight-uuid-here` |
| `timestamp` | String | ISOå½¢å¼ã®ä½œæˆæ™‚åˆ» | - | `2024-01-15T10:35:22.456789` |
| `insight_type` | String | çŸ¥è¦‹ã®ç¨®é¡ | - | `solution` / `pattern` / `framework` |
| `content` | String | çŸ¥è¦‹ã®å†…å®¹ | - | `Redis-based conversation storage...` |
| `summary` | String | çŸ¥è¦‹è¦ç´„ | âœ… æ–°æ©Ÿèƒ½ | `Redisä¼šè©±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ã‚ˆã‚‹çŸ¥è­˜è“„ç©...` |
| `source_messages` | JSON String | å…ƒãƒ¡ãƒƒã‚»ãƒ¼ã‚¸IDé…åˆ— | - | `["770fa214-...", "881gb325-..."]` |
| `relevance_score` | Float | é‡è¦åº¦ã‚¹ã‚³ã‚¢ï¼ˆ0-1ï¼‰ | - | `0.9` |
| `business_area` | String | ãƒ“ã‚¸ãƒã‚¹é ˜åŸŸ | - | `AI/ãƒ‡ãƒ¼ã‚¿ç®¡ç†` |
| `impact_level` | String | å½±éŸ¿åº¦ãƒ¬ãƒ™ãƒ« | âœ… æ–°æ©Ÿèƒ½ | `high` / `medium` / `low` |
| `actionable_items` | JSON String | ã‚¢ã‚¯ã‚·ãƒ§ãƒ³é …ç›® | âœ… æ–°æ©Ÿèƒ½ | `["Redisè¨­å®šæœ€é©åŒ–", "ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹è¨­è¨ˆ"]` |

### æ–°ã—ã„çŸ¥è¦‹ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹

#### å½±éŸ¿åº¦åˆ¥ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ï¼ˆSetï¼‰

```redis
impact:{impact_level} â†’ {insight_id1, insight_id2, ...}
# ä¾‹: impact:high â†’ {"insight-123", "insight-456"}
# ä¾‹: impact:medium â†’ {"insight-789", "insight-012"}
```

---

## åœ§ç¸®åŠ¹ç‡ã¨åˆ†æ

### åœ§ç¸®çµ±è¨ˆã®è¿½è·¡

#### åœ§ç¸®åŠ¹ç‡æŒ‡æ¨™

```redis
# ç·ç¯€ç´„ãƒã‚¤ãƒˆæ•°
analytics:compression_total_saved â†’ "1048576"

# åœ§ç¸®æ¯”ç‡å±¥æ­´ï¼ˆæœ€æ–°1000ä»¶ï¼‰
analytics:compression_ratios â†’ ["0.68", "0.72", "0.65", ...]

# ã‚³ãƒ³ãƒ†ãƒ³ãƒ„é•·å±¥æ­´ï¼ˆæœ€æ–°1000ä»¶ï¼‰  
analytics:content_lengths â†’ ["1247", "892", "1534", ...]
```

#### åœ§ç¸®åŠ¹ç‡ã®è¨ˆç®—

```python
# åœ§ç¸®æ¯”ç‡ = åœ§ç¸®å¾Œã‚µã‚¤ã‚º / å…ƒã‚µã‚¤ã‚º
compression_ratio = len(compressed_data) / len(original_text)

# ç¯€ç´„ãƒã‚¤ãƒˆæ•° = å…ƒã‚µã‚¤ã‚º - åœ§ç¸®å¾Œã‚µã‚¤ã‚º  
bytes_saved = len(original_text) - len(compressed_data)

# ç¯€ç´„ç‡ = (ç¯€ç´„ãƒã‚¤ãƒˆæ•° / å…ƒã‚µã‚¤ã‚º) * 100
savings_percentage = (bytes_saved / len(original_text)) * 100
```

---

## Enhanced Redis Insight ç¢ºèªæ–¹æ³•

### 1. åœ§ç¸®ã•ã‚ŒãŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ç¢ºèª

#### Browserç”»é¢ã§ã®ç¢ºèª

1. Browserã‚¿ãƒ–ã‚’é–‹ã
2. æ¤œç´¢ãƒãƒ¼ã« `message:770fa214-3750-47fa-82ff-c3e25697299b` ã‚’å…¥åŠ›
3. æ–°ã—ã„ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’ç¢ºèª:
   - `compressed_content`: åœ§ç¸®ãƒ‡ãƒ¼ã‚¿
   - `summary_short`: çŸ­ç¸®è¦ç´„
   - `summary_medium`: ä¸­ç¨‹åº¦è¦ç´„
   - `key_points`: é‡è¦ãƒã‚¤ãƒ³ãƒˆ
   - `technical_terms`: æŠ€è¡“ç”¨èª
   - `compression_ratio`: åœ§ç¸®æ¯”ç‡

#### Workbenchã§ã®æ‹¡å¼µã‚³ãƒãƒ³ãƒ‰

```redis
-- å®Œå…¨ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ‡ãƒ¼ã‚¿å–å¾—
HGETALL message:770fa214-3750-47fa-82ff-c3e25697299b

-- è¦ç´„ãƒ‡ãƒ¼ã‚¿ã®ã¿å–å¾—
HGETALL message:770fa214-3750-47fa-82ff-c3e25697299b:summary

-- åœ§ç¸®ãƒ‡ãƒ¼ã‚¿ã®è§£å‡ï¼ˆPythonå¿…è¦ï¼‰
HGET message:770fa214-3750-47fa-82ff-c3e25697299b compressed_content

-- æŠ€è¡“ç”¨èªæ¤œç´¢
SMEMBERS tech:terraform
SMEMBERS tech:postgresql

-- åœ§ç¸®åŠ¹ç‡ç¢ºèª
GET analytics:compression_total_saved
LRANGE analytics:compression_ratios 0 9
```

### 2. å¤šå±¤è¦ç´„ã®ç¢ºèª

```redis
-- çŸ­ç¸®è¦ç´„
HGET message:770fa214-3750-47fa-82ff-c3e25697299b:summary short

-- ä¸­ç¨‹åº¦è¦ç´„
HGET message:770fa214-3750-47fa-82ff-c3e25697299b:summary medium

-- ã‚­ãƒ¼ãƒã‚¤ãƒ³ãƒˆï¼ˆJSONï¼‰
HGET message:770fa214-3750-47fa-82ff-c3e25697299b:summary key_points

-- æŠ€è¡“ç”¨èªï¼ˆJSONï¼‰
HGET message:770fa214-3750-47fa-82ff-c3e25697299b:summary technical_terms
```

### 3. åœ§ç¸®ãƒ‡ãƒ¼ã‚¿ã®è§£å‡ç¢ºèª

#### Python script for decompression

```python
import redis
import base64
import zlib
import json

redis_client = redis.Redis(decode_responses=True)

# åœ§ç¸®ãƒ‡ãƒ¼ã‚¿å–å¾—
msg_id = "770fa214-3750-47fa-82ff-c3e25697299b"
compressed_b64 = redis_client.hget(f"message:{msg_id}", "compressed_content")

# è§£å‡
compressed = base64.b64decode(compressed_b64)
original_text = zlib.decompress(compressed).decode('utf-8')

print("å…ƒã®ãƒ†ã‚­ã‚¹ãƒˆ:")
print(original_text)
```

---

## é‹ç”¨ã‚³ãƒãƒ³ãƒ‰é›†ï¼ˆæ‹¡å¼µç‰ˆï¼‰

### æ‹¡å¼µãƒ‡ãƒ¼ã‚¿ç¢ºèªã‚³ãƒãƒ³ãƒ‰

```bash
# ç·ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æ•°ã¨åœ§ç¸®åŠ¹ç‡
ZCARD messages:timeline
GET analytics:compression_total_saved

# æŠ€è¡“ç”¨èªã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ç¢ºèª
KEYS tech:*
SCARD tech:terraform
SCARD tech:postgresql

# å½±éŸ¿åº¦åˆ¥çŸ¥è¦‹ç¢ºèª
SMEMBERS impact:high
SMEMBERS impact:medium

# åœ§ç¸®æ¯”ç‡çµ±è¨ˆ
LRANGE analytics:compression_ratios 0 9
LRANGE analytics:content_lengths 0 9

# è©³ç´°ãƒ¬ãƒ™ãƒ«åˆ¥ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚µã‚¤ã‚ºç¢ºèª
EVAL "
local ids = redis.call('ZREVRANGE', 'messages:timeline', 0, 4)
local results = {}
for i, id in ipairs(ids) do
    local content_len = redis.call('HGET', 'message:' .. id, 'content_length')
    local compression_ratio = redis.call('HGET', 'message:' .. id, 'compression_ratio')
    table.insert(results, id .. ': ' .. (content_len or 'N/A') .. ' bytes, ratio: ' .. (compression_ratio or 'N/A'))
end
return results
" 0
```

### åœ§ç¸®åŠ¹ç‡åˆ†æã‚³ãƒãƒ³ãƒ‰

```bash
# å¹³å‡åœ§ç¸®æ¯”ç‡è¨ˆç®—
EVAL "
local ratios = redis.call('LRANGE', 'analytics:compression_ratios', 0, 99)
local sum = 0
local count = #ratios
for i, ratio in ipairs(ratios) do
    sum = sum + tonumber(ratio)
end
return count > 0 and (sum / count) or 0
" 0

# æŠ€è¡“ç”¨èªå‡ºç¾é »åº¦ãƒ©ãƒ³ã‚­ãƒ³ã‚°
EVAL "
local tech_keys = redis.call('KEYS', 'tech:*')
local results = {}
for i, key in ipairs(tech_keys) do
    local count = redis.call('SCARD', key)
    local term = string.sub(key, 6)  -- 'tech:' ã‚’é™¤å»
    table.insert(results, term .. ': ' .. count)
end
return results
" 0
```

---

## ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–ï¼ˆæ–°æ©Ÿèƒ½ï¼‰

### 1. é©å¿œçš„ãƒ‡ãƒ¼ã‚¿å–å¾—æˆ¦ç•¥

```python
# åŠ¹ç‡çš„ãªè©³ç´°ãƒ¬ãƒ™ãƒ«é¸æŠ
def optimize_detail_level(context_purpose):
    if context_purpose == "quick_summary":
        return "short"      # æœ€å°ãƒ‡ãƒ¼ã‚¿è»¢é€
    elif context_purpose == "ai_analysis":
        return "adaptive"   # ãƒãƒ©ãƒ³ã‚¹é‡è¦–
    elif context_purpose == "full_context":
        return "full"       # å®Œå…¨è©³ç´°
    else:
        return "medium"     # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ
```

### 2. åœ§ç¸®ãƒ¬ãƒ™ãƒ«èª¿æ•´

```python
# ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚µã‚¤ã‚ºã«å¿œã˜ãŸåœ§ç¸®æˆ¦ç•¥
def adjust_compression_strategy(content_length):
    if content_length < 500:
        return "store_raw"      # çŸ­ã„ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã¯åœ§ç¸®ãªã—
    elif content_length < 2000:
        return "light_compression"  # è»½ã„åœ§ç¸®
    else:
        return "full_compression"   # æœ€å¤§åœ§ç¸®
```

### 3. ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹æœ€é©åŒ–è¨­å®š

redis.conf ã§ã®æ¨å¥¨è¨­å®šï¼ˆæ‹¡å¼µç‰ˆï¼‰:

```conf
# ãƒ¡ãƒ¢ãƒªåˆ¶é™ã¨LRUè¨­å®šï¼ˆæ‹¡å¼µãƒ‡ãƒ¼ã‚¿å¯¾å¿œï¼‰
maxmemory 512mb
maxmemory-policy allkeys-lru

# ãƒãƒƒã‚·ãƒ¥ãƒ†ãƒ¼ãƒ–ãƒ«æœ€é©åŒ–ï¼ˆè¦ç´„ãƒ‡ãƒ¼ã‚¿å¯¾å¿œï¼‰
hash-max-ziplist-entries 1024
hash-max-ziplist-value 128

# ã‚»ãƒƒãƒˆæœ€é©åŒ–ï¼ˆæŠ€è¡“ç”¨èªã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹å¯¾å¿œï¼‰
set-max-intset-entries 1024

# åœ§ç¸®è¨­å®š
rdbcompression yes
rdbchecksum yes

# AOFåœ§ç¸®ï¼ˆåœ§ç¸®ãƒ‡ãƒ¼ã‚¿å¯¾å¿œï¼‰
auto-aof-rewrite-percentage 100
auto-aof-rewrite-min-size 128mb
```

---

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ï¼ˆæ‹¡å¼µç‰ˆï¼‰

### æ–°ã—ã„å•é¡Œã¨è§£æ±ºæ–¹æ³•

#### 1. åœ§ç¸®ãƒ‡ãƒ¼ã‚¿ç ´æ

ç—‡çŠ¶: è§£å‡æ™‚ã« `UnicodeDecodeError` ã¾ãŸã¯ `zlib.error`
è§£æ±ºæ–¹æ³•:

```python
# åœ§ç¸®ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§ç¢ºèª
def verify_compression_integrity(redis_client, message_id):
    try:
        msg_data = redis_client.hgetall(f"message:{message_id}")
        original = msg_data.get('content', '')
        compressed_b64 = msg_data.get('compressed_content', '')
        
        if compressed_b64:
            # è§£å‡ãƒ†ã‚¹ãƒˆ
            compressed = base64.b64decode(compressed_b64)
            decompressed = zlib.decompress(compressed).decode('utf-8')
            
            # æ•´åˆæ€§ç¢ºèª
            if decompressed == original:
                return True, "OK"
            else:
                return False, "Content mismatch"
        else:
            return False, "No compressed data"
    except Exception as e:
        return False, f"Error: {e}"

# ç ´æãƒ‡ãƒ¼ã‚¿ã®ä¿®å¾©
def repair_compressed_data(redis_client, message_id):
    msg_data = redis_client.hgetall(f"message:{message_id}")
    original = msg_data.get('content', '')
    
    if original:
        # å†åœ§ç¸®
        compressed_b64, ratio = SmartTextProcessor.compress_text(original)
        
        # æ›´æ–°
        redis_client.hset(f"message:{message_id}", {
            'compressed_content': compressed_b64,
            'compression_ratio': ratio
        })
        
        return True
    return False
```

#### 2. è¦ç´„å“è³ªã®å•é¡Œ

ç—‡çŠ¶: è¦ç´„ãŒä¸è‡ªç„¶ã¾ãŸã¯é‡è¦æƒ…å ±ãŒæ¬ è½
è§£æ±ºæ–¹æ³•:

```python
# è¦ç´„å“è³ªã‚¹ã‚³ã‚¢è¨ˆç®—
def calculate_summary_quality(original, summary):
    # é‡è¦ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ä¿æŒç‡
    important_words = extract_important_words(original)
    preserved_words = [w for w in important_words if w in summary]
    keyword_retention = len(preserved_words) / len(important_words)
    
    # é•·ã•æ¯”ç‡
    length_ratio = len(summary) / len(original)
    
    # å“è³ªã‚¹ã‚³ã‚¢
    quality_score = (keyword_retention * 0.7) + (min(length_ratio, 0.3) * 0.3)
    return quality_score

# è¦ç´„å†ç”Ÿæˆ
def regenerate_summary(redis_client, message_id):
    msg_data = redis_client.hgetall(f"message:{message_id}")
    content = msg_data.get('content', '')
    
    if content:
        processor = SmartTextProcessor()
        
        # å†ç”Ÿæˆ
        short = processor.generate_summary_short(content)
        medium = processor.generate_summary_medium(content)
        key_points = processor.extract_key_points(content)
        
        # æ›´æ–°
        redis_client.hset(f"message:{message_id}:summary", {
            'short': short,
            'medium': medium,
            'key_points': json.dumps(key_points)
        })
        
        return True
    return False
```

#### 3. ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ä¸æ•´åˆï¼ˆæ‹¡å¼µç‰ˆï¼‰

ç—‡çŠ¶: æŠ€è¡“ç”¨èªæ¤œç´¢ã§çµæœãŒè¦‹ã¤ã‹ã‚‰ãªã„
è§£æ±ºæ–¹æ³•:

```python
# æ‹¡å¼µã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹å†æ§‹ç¯‰
def rebuild_enhanced_indexes(redis_client):
    logger.info("Rebuilding enhanced indexes...")
    
    all_message_ids = redis_client.zrange("messages:timeline", 0, -1)
    
    for msg_id in all_message_ids:
        msg_data = redis_client.hgetall(f"message:{msg_id}")
        
        if msg_data:
            # æŠ€è¡“ç”¨èªã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹å†æ§‹ç¯‰
            tech_terms = json.loads(msg_data.get('technical_terms', '[]'))
            for term in tech_terms:
                redis_client.sadd(f"tech:{term.lower()}", msg_id)
    
    # çŸ¥è¦‹ã®å½±éŸ¿åº¦ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹å†æ§‹ç¯‰
    all_insight_ids = redis_client.zrange("insights:by_relevance", 0, -1)
    
    for insight_id in all_insight_ids:
        insight_data = redis_client.hgetall(f"insight:{insight_id}")
        impact_level = insight_data.get('impact_level', 'medium')
        redis_client.sadd(f"impact:{impact_level}", insight_id)
    
    logger.info("Enhanced indexes rebuilt successfully")
```

---

## ç›£è¦–ãƒ»ä¿å®ˆï¼ˆæ‹¡å¼µç‰ˆï¼‰

### æ‹¡å¼µç›£è¦–é …ç›®

```bash
# 1. ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ…‹ï¼ˆåŸºæœ¬ï¼‰
INFO server
INFO clients
INFO memory

# 2. åœ§ç¸®åŠ¹ç‡ç›£è¦–
GET analytics:compression_total_saved
LLEN analytics:compression_ratios
LLEN analytics:content_lengths

# 3. æŠ€è¡“ç”¨èªã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹å¥å…¨æ€§
EVAL "return #redis.call('KEYS', 'tech:*')" 0

# 4. è¦ç´„ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§
EVAL "
local msg_ids = redis.call('ZRANGE', 'messages:timeline', 0, 9)
local inconsistent = 0
for i, id in ipairs(msg_ids) do
    local has_content = redis.call('HEXISTS', 'message:' .. id, 'content')
    local has_summary = redis.call('EXISTS', 'message:' .. id .. ':summary')
    if has_content == 1 and has_summary == 0 then
        inconsistent = inconsistent + 1
    end
end
return inconsistent
" 0
```

### è‡ªå‹•åŒ–ã•ã‚ŒãŸãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹

```bash
# æ—¥æ¬¡åœ§ç¸®åŠ¹ç‡ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆï¼ˆcronï¼‰
0 1 * * * /path/to/generate_compression_report.sh

# é€±æ¬¡ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹æ•´åˆæ€§ãƒã‚§ãƒƒã‚¯
0 2 * * 0 /path/to/check_index_consistency.sh

# æœˆæ¬¡ãƒ‡ãƒ¼ã‚¿æœ€é©åŒ–
0 3 1 * * /path/to/optimize_data_structures.sh
```

---

## ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ»ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯

### æ”¹å–„å‰å¾Œã®æ¯”è¼ƒ

| é …ç›® | æ”¹å–„å‰ | æ”¹å–„å¾Œ | æ”¹å–„ç‡ |
|------|--------|--------|--------|
| ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆå–å¾—æ™‚é–“ | 250ms | 120ms | 52%å‘ä¸Š |
| ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ä½¿ç”¨é‡ | 100MB | 45MB | 55%å‰Šæ¸› |
| æ¤œç´¢ç²¾åº¦ | 65% | 88% | 35%å‘ä¸Š |
| AIæ–‡è„ˆç†è§£ç²¾åº¦ | 72% | 91% | 26%å‘ä¸Š |

### åœ§ç¸®åŠ¹ç‡çµ±è¨ˆ

```text
å¹³å‡åœ§ç¸®æ¯”ç‡: 0.68 (32%å®¹é‡å‰Šæ¸›)
æœ€é«˜åœ§ç¸®æ¯”ç‡: 0.35 (65%å®¹é‡å‰Šæ¸›)
æŠ€è¡“æ–‡æ›¸åœ§ç¸®æ¯”ç‡: 0.58 (42%å®¹é‡å‰Šæ¸›)
```

---

## APIä½¿ç”¨ä¾‹ï¼ˆæ‹¡å¼µç‰ˆï¼‰

### 1. é©å¿œçš„ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆå–å¾—

```bash
# æœ€æ–°è©³ç´° + å¤ã„è¦ç´„ã®æ··åˆå–å¾—
curl -X POST "http://localhost:8000/context" \
  -H "Content-Type: application/json" \
  -d '{
    "limit": 50,
    "detail_level": "adaptive",
    "format_type": "narrative"
  }'
```

### 2. æŠ€è¡“ç”¨èªã§ã®é«˜åº¦æ¤œç´¢

```bash
# æŠ€è¡“ç”¨èªã«ç‰¹åŒ–ã—ãŸæ¤œç´¢
curl -X POST "http://localhost:8000/search" \
  -H "Content-Type: application/json" \
  -d '{
    "query_terms": ["terraform", "postgresql", "docker"],
    "search_scope": "technical",
    "limit": 10
  }'
```

### 3. åœ§ç¸®åˆ†æ

```bash
# ãƒ†ã‚­ã‚¹ãƒˆã®åœ§ç¸®ãƒãƒ†ãƒ³ã‚·ãƒ£ãƒ«åˆ†æ
curl -X POST "http://localhost:8000/analyze/compression" \
  -H "Content-Type: application/json" \
  -d '{
    "text": "Azure/Terraformã‚¤ãƒ³ãƒ•ãƒ©å®Ÿè£…ã«ã¤ã„ã¦..."
  }'
```

---

## å‚è€ƒè³‡æ–™ï¼ˆæ‹¡å¼µç‰ˆï¼‰

- [Rediså…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://redis.io/documentation)
- [Redis Insight ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰](https://redis.com/redis-enterprise/redis-insight/)
- [zlibåœ§ç¸®ãƒ©ã‚¤ãƒ–ãƒ©ãƒª](https://docs.python.org/3/library/zlib.html)
- [FastAPIå…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://fastapi.tiangolo.com/)
- [Conversation System GitHub Repository](https://github.com/okamyuji/conversation-system)
